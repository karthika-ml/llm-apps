<!DOCTYPE html>
<html>
<head>
    <title>Chat with SQL DB</title>
</head>
<body>
    <h1>Chat with your SQL database</h1>
    <div id="chatbox">
        {% for chat in chat_history %}
            <p><b>{{ chat.role }}:</b> {{ chat.content }}</p>
        {% endfor %}
    </div>
    <form method="POST" action="/">
        <input type="text" name="question" id="question" placeholder="Enter your question">
        <button type="submit">Send</button>
    </form>

    <h2>Connect to database</h2>
    <form method="POST" action="/connect">
        <input type="text" name="host" placeholder="Host" value="intelliswift.database.windows.net"><br>
        <input type="text" name="port" placeholder="Port"><br>
        <input type="text" name="username" placeholder="Username" value="intelli"><br>
        <input type="password" name="password" placeholder="Password" value="Mar@2024"><br>
        <input type="text" name="database" placeholder="Database" value="intelli_db"><br>
        <button type="submit">Connect</button>
    </form>

    <script>
        const chatbox = document.getElementById('chatbox');
        const questionInput = document.getElementById('question');
        const form = document.querySelector('form');

        form.addEventListener('submit', async (event) => {
            event.preventDefault();
            const question = questionInput.value;
            questionInput.value = '';

            fetch('/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: new URLSearchParams({
                    'question': question
                })
            })
            .then(response => response.json())
            .then(data => {
                chatbox.innerHTML = ''; // Clear previous chat
                data.forEach(chat => {
                    const p = document.createElement('p');
                    p.innerHTML = `<b>${chat.role}:</b> ${chat.content}`;
                    chatbox.appendChild(p);
                });
            });
        });
    </script>
</body>
</html>
